<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>webpack | Wen</title><meta name="keywords" content="webpack"><meta name="author" content="肖智文"><meta name="copyright" content="肖智文"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="webpack一、为什么需要打包工具？？webpack是一个模块化打包工具，将不同的资源和文件进行打包，将浏览器不能识别的内容编译成浏览器能够识别的内容。 主要作用  加载编译：将浏览器不认识的语法编译成浏览器认识的语法。less编译成css,es6转换成es5，提升兼容性。  打包资源：减少代码文件数量，从而减少io请求   二、概念核心概念 **entry **(入口) 入口起点，指示 web">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack">
<meta property="og:url" content="https://xiaozhwien.cluod/webpack/webpack/index.html">
<meta property="og:site_name" content="Wen">
<meta property="og:description" content="webpack一、为什么需要打包工具？？webpack是一个模块化打包工具，将不同的资源和文件进行打包，将浏览器不能识别的内容编译成浏览器能够识别的内容。 主要作用  加载编译：将浏览器不认识的语法编译成浏览器认识的语法。less编译成css,es6转换成es5，提升兼容性。  打包资源：减少代码文件数量，从而减少io请求   二、概念核心概念 **entry **(入口) 入口起点，指示 web">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2022-08-07T01:36:02.000Z">
<meta property="article:modified_time" content="2022-08-07T01:45:05.668Z">
<meta property="article:author" content="肖智文">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><link rel="shortcut icon" href="https://xiaozhiwen-hexo.oss-cn-hangzhou.aliyuncs.com/hexo-img/favicon.png"><link rel="canonical" href="https://xiaozhwien.cluod/webpack/webpack/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e8b269d29f11d37885649e49b2e1a22e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 肖智文","link":"链接: ","source":"来源: Wen","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#8b7a5d","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'webpack',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-07 09:45:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/gh/zhheo/JS-Heo@main/bb/showbb_in_index.css"><link rel="stylesheet" href="/self/wen.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://xiaozhiwen-hexo.oss-cn-hangzhou.aliyuncs.com/hexo-img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/essay/"><i class="fa-fw fas fa-bomb"></i><span> 我的动态</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera-retro"></i><span> 照片</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Wen</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/essay/"><i class="fa-fw fas fa-bomb"></i><span> 我的动态</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-camera-retro"></i><span> 照片</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">webpack</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-07T01:36:02.000Z" title="发表于 2022-08-07 09:36:02">2022-08-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-07T01:45:05.668Z" title="更新于 2022-08-07 09:45:05">2022-08-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/webpack/">webpack</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>40分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><h1 id="一、为什么需要打包工具？？"><a href="#一、为什么需要打包工具？？" class="headerlink" title="一、为什么需要打包工具？？"></a>一、为什么需要打包工具？？</h1><p>webpack是一个模块化打包工具，将不同的资源和文件进行打包，将浏览器不能识别的内容编译成浏览器能够识别的内容。</p>
<p>主要作用</p>
<ol>
<li><p>加载编译：将浏览器不认识的语法编译成浏览器认识的语法。less编译成css,es6转换成es5，提升兼容性。</p>
</li>
<li><p>打包资源：减少代码文件数量，从而减少io请求</p>
</li>
</ol>
<h1 id="二、概念"><a href="#二、概念" class="headerlink" title="二、概念"></a>二、概念</h1><h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><ul>
<li><p>**entry **(入口)</p>
<p>入口起点，指示 webpack 应该使用哪个模块，从哪开始打包。分析构建内部依赖图。</p>
</li>
<li><p><strong>output</strong> （输出）</p>
<p>输出，告诉 webpack 打包后的资源 <em>bundle</em>输出到哪里，如何命名。</p>
<p>默认值是 <code>./dist/main.js</code></p>
</li>
<li><p><strong>Loader</strong></p>
<p><strong>Loader 就是将 Webpack 不认识的内容转化为认识的内容</strong></p>
<p>加载器。<strong>loader 让 webpack 能够去处理其他类型的文件。</strong> 相当于是翻译。</p>
<p><strong>webpack 只能处理JavaScript 和 JSON 文件</strong>，这是 webpack 开箱可用的自带能力。</p>
<p>loader 可以链式调用。链中的每个 loader 都将对资源进行转换。<strong>链会逆序执行。</strong></p>
<p>注意 在配置文件中，加载器是&amp;#x20;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>:&#123;</span><br><span class="line">  <span class="attr">rules</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>:<span class="regexp">/.\xxx$/</span></span><br><span class="line">      <span class="attr">use</span>:[<span class="string">&#x27;xxx-loader&#x27;</span>]</span><br><span class="line">    &#125;, </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>plugins</strong></p>
<p>插件，<strong>贯穿 Webpack 打包的生命周期，执行不同的任务</strong>。扩展webpack功能。例如js 或者 css 文件可以自动引入到 Html 中，就需要使用插件 <a href="https://link.juejin.cn/?target=https://www.npmjs.com/package/html-webpack-plugin" title="html-webpack-plugin">html-webpack-plugin</a>来帮助你完成这个操作。plugins与loader不一样，使用前需要require引入。</p>
</li>
<li><p><strong>mode</strong></p>
<p>模式，告诉webpack相应模式的配置。</p>
<p>development，让代码本地调试运行的环境。</p>
<p>production, 让代码优化上线运行的幻想。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image_DzV2hQr2Qo.png"></p>
<h2 id="npx和npm"><a href="#npx和npm" class="headerlink" title="npx和npm"></a>npx和npm</h2><p>npx是一个工具，它是npm v5.2.0引入的一条命令，是npm包执行器</p>
<p>npx主要特点：&amp;#x20;</p>
<blockquote>
<p>1、临时安装可执行依赖包，不用全局安装，不用担心长期的污染。</p>
<p>2、自动加载node_modules中依赖包，npx 会自动查找当前依赖包中的可执行文件，如果找不到，就会去环境变量里面的 PATH 里找。如果依然找不到，会下载到一个临时文件中执行。</p>
<p>3、可以指定node版本、命令的版本，解决了不同项目使用不同版本的命令的问题。</p>
</blockquote>
<h2 id="module、chunk、bundle"><a href="#module、chunk、bundle" class="headerlink" title="module、chunk、bundle"></a>module、chunk、bundle</h2><ul>
<li><p><strong>Module</strong></p>
<p>对于 webpack 来说，项目源码中所有资源（包括 JS、CSS、Image、Font 等等）都属于 module 模块。一个单独的文件就是一个module。</p>
</li>
<li><p><strong>Chunk</strong></p>
<p>chunk代码块是在打包过程中，webpack 会根据文件引用关系生成 chunk 文件，通常，<code>chunk</code>直接与<code>bundle</code>对应，但是有些配置不会产生一对一的关系，例如<code>MiniCssExtractPlugin</code>可从<code>chunk</code>中抽离出<code>css</code>文件，单独生成<code>bundle</code>。</p>
<p>生成chunk的方式——<strong>多入口，代码分割</strong></p>
</li>
<li><p><strong>Bundle</strong></p>
<p>webpack 处理完 chunk 文件之后，最终会输出文件，这个 bundle 文件包含了经过加载和编译的最终产物，例如当一个chunk过大时，我们希望将其拆分。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image_mRy9RBQn0S.png"></p>
<h1 id="三、最简单的配置文件"><a href="#三、最简单的配置文件" class="headerlink" title="三、最简单的配置文件"></a>三、最简单的配置文件</h1><p>webpack的配置文件在<strong>根目录</strong>下创建<strong>webpack.config.js</strong>。（固定写法），配置文件在nodejs中执行的，使用的模块化是commonjs模块化。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)  <span class="comment">//node path 模块</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="comment">// 相对路径和绝对路径都行</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// path: 文件输出目录，必须是绝对路径</span></span><br><span class="line">    <span class="comment">// path.resolve()方法返回一个绝对路径</span></span><br><span class="line">    <span class="comment">// __dirname 当前文件的文件夹绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="comment">// filename: 输出文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 加载器</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>, <span class="comment">// 开发模式</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当使用webpack.config.js配置文件后，可以直接<code>npx webpack</code> ，会自动在根目录下找到配置文件，按照配置文件进行打包。</p>
<h1 id="四、开发环境"><a href="#四、开发环境" class="headerlink" title="四、开发环境"></a>四、开发环境</h1><h2 id="开发环境介绍"><a href="#开发环境介绍" class="headerlink" title="开发环境介绍"></a>开发环境介绍</h2><p>开发模式顾名思义就是我们开发代码时使用的模式。</p>
<p>这个模式下我们主要做两件事：</p>
<ol>
<li><p>编译代码，使浏览器能识别运行</p>
<p>开发时我们有样式资源、字体图标、图片资源、html 资源等，webpack 默认都不能处理这些资源，所以我们要加载配置来编译这些资源.</p>
</li>
<li><p>代码质量检查，树立代码规范</p>
<p>提前检查代码的一些隐患，让代码运行时能更加健壮。eslint</p>
<p>提前检查代码规范和格式，统一团队编码风格，让代码更优雅美观。</p>
</li>
</ol>
<h2 id="0-安装"><a href="#0-安装" class="headerlink" title="0.安装"></a>0.安装</h2><p><code>npm init -y</code> 使用npm</p>
<p><code>npm install --save-dev webpack webpack-cli</code>  安装webpack</p>
<p>创建webpack.config.js 文件</p>
<p>打包命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=development</span><br><span class="line"><span class="comment">#  npx webpack  入口文件  --mode=打包模式</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 当有webpackconfig可以直接使用</span><br><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<p><code>Webpack</code> 本身功能比较少只能打包处理 <code>js</code> 资源es6模块化语法（import），并不能编译其他语法。一旦遇到 <code>css</code> 等其他资源就会报错。</p>
<h2 id="1-处理css资源"><a href="#1-处理css资源" class="headerlink" title="1.处理css资源"></a>1.处理css资源</h2><h3 id="1-css"><a href="#1-css" class="headerlink" title="1.css"></a>1.css</h3><p>1.安装loader加载器<code>npm i css-loader</code>   <code> npm i style-loader</code></p>
<p>2.修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">   &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,    <span class="comment">//正则</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">   &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p><strong>use的执行顺序是从右到左，从上到下。</strong></p>
<p>&amp;#x20;”css-loader”： 加载.css文件，编译成一个commonjs模块到js中。</p>
<p>“style-loader”：使用<code>&lt;style&gt;</code>将css-loader内部样式注入到HTML页面</p>
<p>3.导入打包入口文件，要想webpack打包资源，必须引入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./css/index.css&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-less"><a href="#2-less" class="headerlink" title="2.less"></a>2.less</h3><p>注意，如果打包less 需要使用&amp;#x20;</p>
<p><code>npm i -D less </code></p>
<p><code>npm i -D less-loader </code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>,<span class="string">&#x27;less-loader&#x27;</span>],</span><br></pre></td></tr></table></figure>

<p>并且，如果同时有css,less文件，处理时不能合并。</p>
<h3 id="3-sass"><a href="#3-sass" class="headerlink" title="3.sass"></a>3.sass</h3><p>Sass 和 Scss 其实就是同一种东西，我们平时都称之为 Sass，两者之间不同之处主要有以下两点：</p>
<p>1、文件扩展名不同，Sass 是以“.sass”后缀为扩展名，而 Scss 是以“.scss”后缀为扩展名。</p>
<p>2、语法书写方式不同，Sass 是以严格的缩进式语法规则来书写，不带大括号({})和分号(;)，而 Scss 的语法书写和我们的CSS 语法书写方式非常类似。</p>
<p>与less类似，1.下载依赖，2.webpack文件配置，3.引入入口文件</p>
<h2 id="2-处理js资源"><a href="#2-处理js资源" class="headerlink" title="2.处理js资源"></a>2.处理js资源</h2><p>基础的Webpack 对 js 处理是有限的，只能编译 js 中 ES 模块化语法，不能编译其他语法（先eslint,再babel）</p>
<ul>
<li><p>代码格式——Eslint&amp;#x20;</p>
</li>
<li><p>js 兼容性处理——Babel&amp;#x20;</p>
</li>
</ul>
<h3 id="1-eslint"><a href="#1-eslint" class="headerlink" title="1.eslint"></a>1.eslint</h3><p>eslint是可组装的 JavaScript 和 JSX 检查工具。eslint本身不会检测，关键是写 Eslint 配置文件，Eslint 就会以写的规则对代码进行检查。</p>
<p>webpack4是个loader,在  webpack5 是一个plugins</p>
<ol>
<li><p><strong>下载安装</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint-webpack-plugin --save-dev</span><br><span class="line">npm install eslint --save-dev</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建配置文件</strong></p>
<p>1.命令行生成<code>npx eslint  —init</code>  初始化项目配置文件</p>
<p>2.手动生成，根目录创建<code>.eslintrc.js</code> 、 <code>.eslintignore</code>文件。</p>
<p>eslint配置文件详情见eslint笔记</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 解析选项</span></span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="number">6</span>, <span class="comment">// ES 语法版本</span></span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>, <span class="comment">// ES 模块化</span></span><br><span class="line">    <span class="attr">ecmaFeatures</span>: &#123; <span class="comment">// ES 其他特性</span></span><br><span class="line">      <span class="attr">jsx</span>: <span class="literal">true</span> <span class="comment">// 如果是 React 项目，就需要开启 jsx 语法</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span>, <span class="comment">// 启用node中全局变量</span></span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>, <span class="comment">// 启用浏览器中全局变量</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 具体检查规则</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="attr">semi</span>: <span class="string">&quot;error&quot;</span>, <span class="comment">// 禁止使用分号</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 继承其他规则， rules会覆盖掉react-app的规则</span></span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&quot;react-app&quot;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 其他规则详见：https://eslint.bootcss.com/docs/user-guide/configuring</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>webpack.config.js配置</strong></p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/eslint-webpack-plugin/" title="EslintWebpackPlugin ">EslintWebpackPlugin </a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">ESLintPlugin</span>(&#123;</span><br><span class="line">  <span class="comment">//指定文件根目录，类型为字符串。需要检查的文件</span></span><br><span class="line">  <span class="attr">context</span>:path.<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">  <span class="attr">extensions</span>:<span class="string">&#x27;js&#x27;</span>,  <span class="comment">//指定需要检查的扩展名。</span></span><br><span class="line">  <span class="attr">cache</span>: <span class="literal">true</span>,  <span class="comment">// 开启缓存</span></span><br><span class="line">  <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span>), </span><br><span class="line">  <span class="attr">esclude</span>:<span class="string">&#x27;node_modules&#x27;</span>  <span class="comment">//默认排除文档。</span></span><br><span class="line">&#125;)],</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-babel代码兼容性"><a href="#2-babel代码兼容性" class="headerlink" title="2.babel代码兼容性"></a>2.babel代码兼容性</h3><p>babel可以将高级的es语法，编译成低级的es语法。用于兼容。</p>
<ol>
<li><p>安装</p>
<p><code>npm install babel-loader babel-core babel-preset-env webpack</code></p>
</li>
<li><p>配置webpack&amp;#x20;</p>
<p>&amp;#x20;rules中添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 进行js兼容性的处理</span></span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/(node_modules|bower_components)/</span>,   <span class="comment">//一定要排除node_modules模块</span></span><br><span class="line">  <span class="attr">use</span>: &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//https://www.babeljs.cn/docs/babel-preset-env</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>关于presets :是一个智能预设插件，可以根据条件去编译成不同版本的js代码。具体见<a target="_blank" rel="noopener" href="https://www.babeljs.cn/docs/babel-preset-env" title="Babel 中文网 ">Babel 中文网 </a>。其中浏览器版本管理默认使用的是<a target="_blank" rel="noopener" href="https://github.com/browserslist/browserslist" title="browserslist">browserslist</a>，可以通过browserslist的相关配置去指定需要兼容的浏览器版本列表。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/seveneagleline/article/details/107745575" title="babel preset-env">babel preset-env</a></p>
</li>
</ol>
<h2 id="3-清空打包文件"><a href="#3-清空打包文件" class="headerlink" title="3.清空打包文件"></a>3.清空打包文件</h2><p>webpack5不需要单独下载clean-webpack-plugin</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">// 自动将上次打包目录资源清空</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="4-打包图片资源"><a href="#4-打包图片资源" class="headerlink" title="4.打包图片资源"></a>4.打包图片资源</h2><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/asset-modules/#root" title="webpack资源模块.">webpack资源模块.</a></p>
<p>在 Webpack4 时，使用的是<code>file-loader</code> 、<code>url-loader</code> 、<code>raw-loader</code>进行处理。</p>
<p>webpack5将上述loader内置到webpack中了。资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换上述loader：</p>
<ul>
<li><p><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现。（所有匹配的文件都将复制到输出目录，并且新的路径将被注入到 bundle 中。）</p>
</li>
<li><p><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现。所有匹配的文件都将作为 data URI 注入到 bundle 中。（使用base64编码在行内显示，匹配的文件不会输出到目录。）</p>
</li>
<li><p><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现。（所有匹配的文件将原样注入到 bundle 中，匹配的文件不会输出到目录。）</p>
</li>
<li><p><code>asset</code> 在<code>resource</code>** &#x2F;**<code>inline</code>**自动选择 **。之前通过使用<code>url-loader</code>。当parser条件满足时候使用inline否则使用resource</p>
</li>
</ul>
<p>只需要简单配置就可以处理图片资源。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,   <span class="comment">//类型，静态资源</span></span><br><span class="line">    <span class="attr">parser</span>: &#123;    <span class="comment">//切换asset 转换的条件</span></span><br><span class="line">       <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">           <span class="attr">maxSize</span>: <span class="number">4</span> * <span class="number">1024</span> <span class="comment">// 4kb</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;，</span><br><span class="line">    <span class="attr">generator</span>: &#123;   <span class="comment">//输出文件到指定目录</span></span><br><span class="line">       <span class="attr">filename</span>: <span class="string">&#x27;static/[hash][ext][query]&#x27;</span>  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>使用base64压缩文件的优缺点</strong></p>
<p>优点：请求数量减小（减轻服务器压力）</p>
<p>缺点：图片体积会更大，（文件请求速度更慢）</p>
<p>注意：<strong>默认处理不了html中的img图片</strong>，因为img标签中的引用不会被打包， 而且，打包后，图片的名称会改变，因此无法引用。处理html中的图片  使用 <code>npm i -D html-loader</code>。</p>
<p>注意如果使用了url-loader，会出错，因为url-loader使用的是es6模块化解析，html-loader使用的是commonjs，解析时会出错。解决：关闭url-loader的es6模块<code>esModule:false</code>，都是用commonjs</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;../img/1.jpg&quot;</span>/&gt;</span><br><span class="line"> ------------------配置webpack.<span class="property">config</span>.<span class="property">js</span>----------------</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.html$/</span>,</span><br><span class="line">  <span class="attr">use</span>:[<span class="string">&#x27;html-loader&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-字体及图标等资源的打包"><a href="#5-字体及图标等资源的打包" class="headerlink" title="5.字体及图标等资源的打包"></a>5.字体及图标等资源的打包</h2><p>以<a target="_blank" rel="noopener" href="https://www.iconfont.cn/" title="阿里巴巴矢量图标库">阿里巴巴矢量图标库</a>为例</p>
<ol>
<li><p>下载资源</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image_5CfSarqxbT.png"></p>
</li>
<li><p>导入资源</p>
<p>下载代码后有压缩包，我们需要导入的是如下几个文件。</p>
<ul>
<li><p>src&#x2F;fonts&#x2F;iconfont.ttf</p>
</li>
<li><p>src&#x2F;fonts&#x2F;iconfont.woff</p>
</li>
<li><p>src&#x2F;fonts&#x2F;iconfont.woff2</p>
</li>
<li><p>src&#x2F;css&#x2F;iconfont.css     &#x2F;&#x2F;注意字体文件路径需要修改</p>
</li>
</ul>
</li>
<li><p>使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;i <span class="keyword">class</span>=<span class="string">&quot;iconfont icon-arrow-down&quot;</span>&gt;&lt;/i&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>webpack内置，可以直接处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">  <span class="attr">type</span>:<span class="string">&quot;asset/resource&quot;</span>,  <span class="comment">//resource必须加上resource，否则会被base64处理</span></span><br><span class="line">  <span class="attr">generator</span>:&#123;</span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;static/font/[hash][ext][query]&#x27;</span>  <span class="comment">//输出目录</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="6-修改输出资源路径名称"><a href="#6-修改输出资源路径名称" class="headerlink" title="6.修改输出资源路径名称"></a>6.修改输出资源路径名称</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="comment">//js 文件输出到 /js 目录中</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;/js/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 图片文件输出目录配置</span></span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&#x27;images/[hash][ext][query]&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对于例如图片，字体等利用了<strong>资源模块</strong>的文件，另一种自定义输出文件名的方式是，将某些资源发送到指定目录：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">  <span class="attr">type</span>:<span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">  <span class="attr">generator</span>:&#123;</span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;static/font/[hash][ext][query]&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">generator</span>:&#123;</span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;static/image/[hash][ext][query]&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="7-html资源打包-（htmlWebpackPlugin）"><a href="#7-html资源打包-（htmlWebpackPlugin）" class="headerlink" title="7.html资源打包 （htmlWebpackPlugin）"></a>7.html资源打包 （htmlWebpackPlugin）</h2><p>作用：让打包生成的js文件根据模板自动导入到html文档中。像css的<code>style-loader</code>一样自动导入标签，而不是手动引入。</p>
<ol>
<li><p>安装</p>
<p>npm install –save-dev html-webpack-plugin 安装</p>
</li>
<li><p>配置webpack</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">   <span class="comment">//模板， 赋值改模板，并自动引入打包输出的所有资源。</span></span><br><span class="line">   <span class="attr">template</span>:<span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">   <span class="attr">filename</span>:<span class="string">&#x27;index.html&#x27;</span>,  <span class="comment">//打包后输出的文件名。</span></span><br><span class="line">   <span class="attr">inject</span>:<span class="string">&#x27;body&#x27;</span>  <span class="comment">//将打包的js放入到&lt;body&gt;标签中   默认是head</span></span><br><span class="line"> &#125;)],</span><br></pre></td></tr></table></figure>

<p>由于webpack入口出口都是js文件，这个<strong>插件的作用</strong>是在出口生成一个html文件并自动引入打包输出的资源。template的作用是让生成的html复制自己指定的那个html的结构。</p>
</li>
</ol>
<h2 id="8-dev-server-热部署"><a href="#8-dev-server-热部署" class="headerlink" title="8.dev-server 热部署"></a>8.dev-server 热部署</h2><p>用来自动化（自动编译，自动打开浏览器，自动刷新），只会在内存中编译打包，不会有打包文件输出。开启dev-server相当于开启了一个实时打包的服务器。</p>
<ol>
<li><p>安装</p>
<p><code>npm i webpack-dev-server -D</code></p>
</li>
<li><p>配置dev</p>
<p>最简单的dev-server配置</p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/" title="DevServer 详细配置文件 ">DevServer 详细配置文件 </a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">  <span class="attr">port</span>: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">  <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ol>
<p><code>npx webpack serve</code> 5版本启动命令</p>
<p><code>npx webpack-dev-server</code> 4版本启动命令。运行在内存中，不会生成文件。</p>
<p>在开发环境下，dev-server会再内存中自动构建。不需要打包后的文件。可以实时修改。</p>
<p>2.配置本地服务</p>
<p><strong>为什么要配置 contentBase ？</strong></p>
<p>因为 webpack 在进行打包的时候，对静态文件的处理，例如图片，都是直接 copy 到 dist 目录下面。但是对于本地开发来说，这个过程太费时，也没有必要，所以在设置 contentBase 之后，就直接到对应的静态目录下面去读取文件，而不需对文件做任何移动，节省了时间和性能开销。</p>
<h1 id="五、生产环境"><a href="#五、生产环境" class="headerlink" title="五、生产环境"></a>五、生产环境</h1><p>生产模式是开发完成代码后，我们需要得到代码将来部署上线。</p>
<p>优化主要从两个角度出发:</p>
<ol>
<li><p>优化代码运行性能</p>
</li>
<li><p>优化代码打包速度</p>
</li>
</ol>
<p>webpack文件最好分成开发环境和生产环境两个配置文件。在根目录下创建config&#x2F;webpack.dev.js   \ config&#x2F;webpack.prod.js 两个文件，分别进行相应配置（修改路径，mode,output）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//运行开发环境</span></span><br><span class="line">npx webpack serve --config ./config/webpack.<span class="property">dev</span>.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//运行生产环境</span></span><br><span class="line">npx webpack --config ./config/webpack.<span class="property">prod</span>.<span class="property">js</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在package.json中配置脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;npm run dev&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;npx webpack serve --config ./config/webpack.dev.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;npx webpack --config ./config/webpack.prod.js&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>开发模式：<code>npm start</code> 或 <code>npm run dev</code></p>
</li>
<li><p>生产模式：<code>npm run build</code></p>
</li>
</ul>
<h2 id="1-提取CSS成单独文件"><a href="#1-提取CSS成单独文件" class="headerlink" title="1.提取CSS成单独文件"></a>1.提取CSS成单独文件</h2><p>为什么需要单独提取出css文件？</p>
<p>由于当前css 文件目前被打包到 js 文件中，当 js 文件加载时，会创建一个 style 标签来生成样式，会出现页面闪屏。</p>
<p>有两种常用的插件，</p>
<p><a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/mini-css-extract-plugin/#root" title="MiniCssExtractPlugin ">MiniCssExtractPlugin </a> 和<a target="_blank" rel="noopener" href="https://www.webpackjs.com/plugins/extract-text-webpack-plugin" title="ExtractTextWebpackPlugin">ExtractTextWebpackPlugin</a></p>
<p>这里使用<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/mini-css-extract-plugin/#root" title="MiniCssExtractPlugin ">MiniCssExtractPlugin </a>&amp;#x20;</p>
<ol>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置webpack.prod.js&amp;#x20;</p>
<p>配置生产环境即可，由于<code>style-loader</code> 作用是通过js创建style标签，将样式放入，而现在css是一个单独文件，因此不需要<code>style-loader</code> 加载器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">    <span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;static/css/main.css&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2-css兼容性处理postcss"><a href="#2-css兼容性处理postcss" class="headerlink" title="2.css兼容性处理postcss"></a>2.css兼容性处理postcss</h2><p>为了兼容不同的浏览器的样式</p>
<ol>
<li><p>安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev postcss-loader postcss  postcss-preset-env</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置生产文件</p>
<p>必须写在 “css-loader”,之后，less等其他处理器之前。</p>
<p>post-preset-env  帮助post识别环境</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">use</span>: [</span><br><span class="line">  <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">  <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">      <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [</span><br><span class="line">          <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">           &#123;</span><br><span class="line">              <span class="comment">// Options:设置浏览器兼容性</span></span><br><span class="line">              <span class="attr">browsers</span>:[<span class="string">&quot;last 2 version&quot;</span>, <span class="string">&quot;&gt; 1%&quot;</span>, <span class="string">&quot;not dead&quot;</span>]</span><br><span class="line">           &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;less-loader&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure></li>
</ol>
<p>封装cssloaders</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    preProcessor,</span><br><span class="line">  ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">  <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">  <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  <span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-压缩css代码"><a href="#3-压缩css代码" class="headerlink" title="3.压缩css代码"></a>3.压缩css代码</h2><p>压缩css代码</p>
<p>CssMinimizerWebpackPlugin 可以将css压缩成一行。</p>
<p>优点：允许缓存 ，并行工作压缩</p>
<ol>
<li><p>安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i css-minimizer-webpack-plugin -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="attr">plugins</span>: [ </span><br><span class="line">  <span class="comment">// css压缩</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">],</span><br></pre></td></tr></table></figure></li>
</ol>
<p>默认生产模式已经开启了：html 压缩和 js 压缩</p>
<h2 id="4-清除无用的-CSS"><a href="#4-清除无用的-CSS" class="headerlink" title="4.清除无用的 CSS"></a>4.清除无用的 CSS</h2><p><a href="https://link.juejin.cn/?target=https://www.purgecss.cn/plugins/webpack.html#%E7%94%A8%E6%B3%95" title="purgecss-webpack-plugin">purgecss-webpack-plugin</a> 会单独提取 CSS 并清除用不到的 CSS</p>
<h2 id="合并开发和生产模式"><a href="#合并开发和生产模式" class="headerlink" title="合并开发和生产模式"></a>合并开发和生产模式</h2><p>&amp;#x20;cross-env</p>
<p>npm install cross-env -D</p>
<h1 id="六、webpack性能优化"><a href="#六、webpack性能优化" class="headerlink" title="六、webpack性能优化"></a>六、webpack性能优化</h1><p>总结：加缓存，搞并行，提前做，少执行</p>
<p>我们从 4 个角度对 webpack 和代码进行了优化：</p>
<ol>
<li><p>提升开发体验</p>
<ul>
<li>使用 <code>Source Map</code> 让开发或上线时代码报错能有更加准确的错误提示。</li>
</ul>
</li>
<li><p>提升 webpack 提升打包构建速度</p>
<ul>
<li><p>使用 <code>HotModuleReplacement</code> HMR 让开发时只重新编译打包更新变化了的代码，不变的代码使用缓存，从而使更新速度更快。</p>
</li>
<li><p>使用 <code>OneOf</code> 让资源文件一旦被某个 loader 处理了，就不会继续遍历了，打包速度更快。</p>
</li>
<li><p>使用 <code>Include/Exclude</code> 排除或只检测某些文件，处理的文件更少，速度更快。</p>
</li>
<li><p>使用 <code>Cache</code> 对 eslint 和 babel 处理的结果进行缓存，让第二次打包速度更快。</p>
</li>
<li><p>使用 <code>Thead</code> 多进程处理 eslint 和 babel 任务，速度更快。（需要注意的是，进程启动通信都有开销的，要在比较多代码处理时使用才有效果）</p>
</li>
</ul>
</li>
<li><p>减少代码体积</p>
<ul>
<li><p>使用 <code>Tree Shaking</code> 剔除了没有使用的多余代码，让代码体积更小。</p>
</li>
<li><p>使用 <code>@babel/plugin-transform-runtime</code> 插件对 babel 进行处理，让辅助代码从中引入，而不是每个文件都生成辅助代码，从而体积更小。</p>
</li>
<li><p>使用 <code>Image Minimizer</code> 对项目中图片进行压缩，体积更小，请求速度更快。（需要注意的是，如果项目中图片都是在线链接，那么就不需要了。本地项目静态图片才需要进行压缩。）</p>
</li>
</ul>
</li>
<li><p>优化代码运行性能</p>
<ul>
<li><p>使用 <code>Code Split</code> 对代码进行分割成多个 js 文件，从而使单个文件体积更小，并行加载 js 速度更快。并通过 import 动态导入语法进行按需加载，从而达到需要使用时才加载该资源，不用时不加载资源。</p>
</li>
<li><p>使用 <code>Preload / Prefetch</code> 对代码进行提前加载，等未来需要使用时就能直接使用，从而用户体验更好。</p>
</li>
<li><p>使用 <code>Network Cache</code> 能对输出资源文件进行更好的命名，将来好做缓存，从而用户体验更好。</p>
</li>
<li><p>使用 <code>Core-js</code> 对 js 进行兼容性处理，让我们代码能运行在低版本浏览器。</p>
</li>
<li><p>使用 <code>PWA</code> 能让代码离线也能访问，从而提升用户体验。</p>
</li>
</ul>
</li>
</ol>
<h2 id="1-代码调试优化"><a href="#1-代码调试优化" class="headerlink" title="1.代码调试优化"></a>1.代码调试优化</h2><h3 id="source-map-amp-x20"><a href="#source-map-amp-x20" class="headerlink" title="source map&amp;#x20;"></a>source map&amp;#x20;</h3><p>当代码打包后，格式和原来我们编写的代码相差很大，假如有一个报错，提示的错误是编译后的错误，可能无法找到该错误。</p>
<p>SourceMap（源代码映射）是一个用来生成源代码与构建后代码一一映射的文件的方案。它会生成一个 xxx.map 文件，里面包含源代码和构建后代码每一行、每一列的映射关系。当构建后代码出错了，会通过 xxx.map 文件，从构建后代码出错位置找到映射后源代码出错位置，从而让浏览器提示源代码文件出错位置，帮助我们更快的找到错误根源。</p>
<p>webpack.config.js 设置devtool即可生成source map文件</p>
<p>中设置<a href="https://link.juejin.cn/?target=https://webpack.js.org/configuration/devtool/" title="devtool">devtool</a>即可生成 <code>Source Map</code> 文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devtool</span>:<span class="string">&quot;inline-source-map&quot;</span>,  <span class="comment">//必须放到plugins前面才不会报错。</span></span><br></pre></td></tr></table></figure>

<h4 id="Source-Map-的工作原理"><a href="#Source-Map-的工作原理" class="headerlink" title="Source Map 的工作原理"></a>Source Map 的工作原理</h4><p>生成的.js文件会添加上注释，用于指明映射.map的文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br></pre></td></tr></table></figure>

<p>映射文件  .map的基本信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image_9VC4rvaclL.png"></p>
<ul>
<li><p><code>version</code>：<code>Source map</code>的版本，目前为<code>v3</code>。</p>
</li>
<li><p><code>sources</code>：转换前的文件。该项是一个数组，表示可能存在多个文件合并。</p>
</li>
<li><p><code>names</code>：转换前的所有变量名和属性名。</p>
</li>
<li><p><code>mappings</code>：记录位置信息的字符串，下文会介绍。</p>
</li>
<li><p><code>file</code>：转换后的文件名。</p>
</li>
<li><p><code>sourceRoot</code>：转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空。</p>
</li>
<li><p><code>sourcesContent</code>：转换前文件的原始内容。</p>
</li>
</ul>
<p><strong>最关键</strong>：mappings 将源码和map文件位置映射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//源码</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//打包编译的后 bundle.js 文件：</span></span><br><span class="line">(<span class="function">() =&gt;</span> &#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line">  <span class="keyword">var</span> __webpack_exports__ = &#123;&#125;;</span><br><span class="line">  <span class="comment">/*!**********************!*\</span></span><br><span class="line"><span class="comment">    !*** ./src/index.js ***!</span></span><br><span class="line"><span class="comment">    \**********************/</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">  <span class="comment">/******/</span></span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//# sourceMappingURL=bundle.js.map</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//.map 文件  关键配置信息 mappings</span></span><br><span class="line"><span class="string">&quot;mappings&quot;</span>: <span class="string">&quot;AAAA;AACA,c&quot;</span>,</span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到 <code>mappings</code> 属性的值是： <code>AAAA; AACA, c</code> ，要想说清楚这个东西，需要先解释一下它的组成结构。这是一个字符串，它分成三层：</p>
<ul>
<li><p>第一层是<strong>行对应</strong>，以分号（; ）表示，每个分号对应转换后源码的一行。所以，第一个分号前的内容，就对应源码的第一行，以此类推。</p>
</li>
<li><p>第二层是<strong>位置对应</strong>，以逗号（, ）表示，每个逗号对应转换后源码的一个位置。所以，第一个逗号前的内容，就对应该行源码的第一个位置，以此类推。</p>
</li>
<li><p>第三层是<strong>位置转换</strong>，以<a href="https://link.juejin.cn/?target=https://en.wikipedia.org/wiki/Variable-length_quantity" title="VLQ 编码">VLQ 编码</a>表示，代表该位置对应的转换前的源码位置。</p>
</li>
</ul>
<p>解释：因为源代码中有两行，所以有一个分号，分号前后表示了第一行和第二行。即mappings中的AAAA和AACA,c。<br>分号后面表示第二行，也就是代码console.log(a);可以拆分出两个位置，分别是console和log(a)，所以存在一个逗号。即AACA,c中的AACA和c。</p>
<h4 id="不同source-map的配置"><a href="#不同source-map的配置" class="headerlink" title="不同source map的配置"></a>不同source map的配置</h4><p><a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/devtool/" title="https://webpack.js.org/configuration/devtool/">https://webpack.js.org/configuration/devtool/</a></p>
<p>官方罗列了 20 几种类型，我们当然不能全部都记住，可以记住几个关键的。</p>
<hr>
<pre><code>1.  生成了单独的 SourceMap 文件，**打包速度慢**

2.  在**源代码**中定位到错误所在**行列**信息
</code></pre>
<hr>
<pre><code>1.  通过 **dataUrl** (base 64)的形式引入 SourceMap 文件,添加到了文件最末尾处。。

2.  在**源代码**中定位到错误所在**行列**信息

![](image/image_js-QmTg_y7.png)
</code></pre>
<hr>
<pre><code>1.  生成代码通过 **** 执行

2.  源代码位置通过 **** 注明，因此无法定位到错误位置，只能定位到**某个**文件

3.  由于不单独打包map文件，此选项会非常快地构建。

![](image/image_AOjDMdt8h_.png)
</code></pre>
<hr>
<pre><code>1.  生成 dataUrl 形式的 SourceMap，打包速度慢

2.  **可以在编译后的代码中定位到错误所在行列信息**

3.  生成 dataUrl 形式的 SourceMap添加到了eval函数中，打包速度慢

![](image/image_1YAcizghPS.png)
</code></pre>
<hr>
<pre><code>1.  生成代码通过 ****** 执行**

2.  包含 **dataUrl** 形式的 SourceMap 文件

3.  **可以在编译后的代码中定位到错误所在行信息**

4.  不需要定位列信息，打包**速度较快**
</code></pre>
<ul>
<li><p><code>eval-cheap-module-source-map</code> 模式：</p>
<ol>
<li><p>生成代码通过  执行</p>
</li>
<li><p>包含 <strong>dataUrl</strong> 形式的 SourceMap 文件</p>
</li>
<li><p>可以在<strong>编译后</strong>的代码中定位到错误所在<strong>行</strong>信息</p>
</li>
<li><p>不需要定位列信息，打包<strong>速度较快</strong></p>
</li>
<li><p><strong>在源代码中定位到错误所在行信息</strong></p>
</li>
</ol>
</li>
</ul>
<hr>
<pre><code>生成source map，但没有引入 source map，在报错信息处也就不会指向源码。如果手动加入，也是会生效的。

![](image/image_l9MyoGNW_k.png)
</code></pre>
<ul>
<li><p>nosources-source-map</p>
<p>此时会生成 source map 文件，打包后的 bundle.js 也会引入map文件，也可以看到报错内容所在文件，但无法获取源码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image_pP6WanZja1.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/image/image_B5MDpJl380.png"></p>
</li>
</ul>
<h4 id="代码质量说明"><a href="#代码质量说明" class="headerlink" title="代码质量说明"></a>代码质量说明</h4><ul>
<li><p><strong>bundled</strong>: 所有生成的代码视作一大块代码。没有相互分离的模块。</p>
</li>
<li><p><strong>generated</strong>: 每个模块相互分离，并用模块名称进行注释。可以看到 webpack 生成的代码。示例：你会看到类似 <code>var module__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(42); module__WEBPACK_IMPORTED_MODULE_1__.a();</code>，而不是 <code>import &#123;test&#125; from &quot;module&quot;; test();</code>。</p>
</li>
<li><p><strong>transformed</strong>: 每个模块相互分离，并用模块名称进行注释。可以看到 loader 转译后、webpack 转换前的代码。示例：你会看到类似 <code>import &#123;test&#125; from &quot;module&quot;; var A = function(_test) &#123; ... &#125;(test);</code>，而不是 <code>import &#123;test&#125; from &quot;module&quot;; class A extends test &#123;&#125;</code>。</p>
</li>
<li><p><strong>original lines</strong>: 每个模块相互分离，并用模块名称进行注释。可以看到转译前的代码。</p>
</li>
<li><p><strong>original</strong>: source map 不包含源码内容。浏览器通常会去服务中加载源代码。</p>
</li>
</ul>
<h4 id="建议配置"><a href="#建议配置" class="headerlink" title="建议配置"></a>建议配置</h4><p>开发环境</p>
<ul>
<li><p><code>eval-source-map</code></p>
<p>使用每个模块执行，<code>eval()</code>并将 SourceMap 作为 DataUrl 添加到<code>eval()</code>. 最初它很慢，但它提供了快速的重建速度并生成真实文件。行号被正确映射，因为它被映射到原始代码。它为开发提供最优质的 SourceMap。</p>
</li>
<li><p><code>eval-cheap-module-source-map</code></p>
<p>与 类似<code>eval-cheap-source-map</code>，但是，来自 Loaders 的 Source Maps 被处理以获得更好的结果。然而，Loader Source Maps 被简化为每行一个映射。</p>
</li>
</ul>
<p>生产环境</p>
<ul>
<li><p><code>source-map</code></p>
<p>&amp;#x20;完整的 SourceMap 作为单独的文件发出。它将参考注释添加到包中，以便开发工具知道在哪里可以找到它。</p>
</li>
<li><p><code>nosources-source-map</code></p>
<p>创建了一个 SourceMap，但其中没有<code>sourcesContent</code>。它可用于在客户端映射堆栈跟踪，而无需暴露所有源代码。您可以将 Source Map 文件部署到 Web 服务器。</p>
</li>
</ul>
<blockquote>
<p>您不应将 Source Map 文件部署到 Web 服务器。而是仅将其用于错误报告工具。注意应该将您的服务器配置为禁止普通用户访问 Source Map 文件！</p>
</blockquote>
<h2 id="2-提升打包速度"><a href="#2-提升打包速度" class="headerlink" title="2. 提升打包速度"></a>2. 提升打包速度</h2><h3 id="1-HMR"><a href="#1-HMR" class="headerlink" title="1.HMR"></a>1.HMR</h3><p>（hot module replacement）模块热替换，只在开发模式下能够使用。</p>
<p>原理：</p>
<ul>
<li><p>当有模块Webpack重新编译构建一个或多个模块，并通知HMR服务器进行了更新。</p>
</li>
<li><p>HMR Server使用websockets通知HMR Runtime需要更新。（HMR运行时通过HTTP请求这些更新。）</p>
</li>
<li><p>HMR运行时再替换更新中的模块。如果确定这些模块无法更新，则触发整个页面刷新</p>
</li>
</ul>
<p>webpack v5默认开启——devserver 配置<code>hot：true</code></p>
<p>HMR: hot module replacement 热模块替换：只会替换修改的模块，其他没有改动的模块不会替换。因此如果有大量的文件，而只修改一个文件的情况下，性能极大的提升。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">static</span>: <span class="string">&#x27;./dist&#x27;</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3001</span>,</span><br><span class="line">    <span class="attr">hot</span>:<span class="literal">true</span>  <span class="comment">//开启HMR功能，默认开启</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>css</strong></p>
<p>css 样式经过 style-loader 处理，支持HMR</p>
</li>
<li><p><strong>js</strong></p>
<p>js文件默认不支持，需要一些特殊处理。 <strong>module.hot</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable language_">module</span>.<span class="property">hot</span>)&#123;</span><br><span class="line">  <span class="comment">//一旦module.hot为true,说明开启了HMR共功能，会让HTR代码生效</span></span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&#x27;./print.js&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="comment">//一旦生效就执行这里的回调函数。</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这样写会很麻烦，所以实际开发我们会使用其他 loader 来解决。比如：<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-loader" title="vue-loader">vue-loader</a>，<a target="_blank" rel="noopener" href="https://github.com/gaearon/react-hot-loader" title="react-hot-loader">react-hot-loader</a>(过时)， 现在使用react refresh</p>
</li>
<li><p><strong>html</strong></p>
<p>默认不会热更新，需要手动刷新。</p>
<p>解决：修改entry入口，将html文档引入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: [<span class="string">&#x27;./src/index.js&#x27;</span>, <span class="string">&#x27;./src/index.html&#x27;</span>],</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7021729340945596424">https://juejin.cn/post/7021729340945596424</a></p>
<h3 id="2-oneof"><a href="#2-oneof" class="headerlink" title="2.oneof"></a>2.oneof</h3><p>开发模式生产模式都可以进行优化， oneof的类似于break语句。里面的loader一旦匹配成功就会跳出匹配。（webpack原本的loader是将每个文件都过一遍，比如有一个js文件 rules中有11个loader，第一个是处 理js文件的loader，当第一个 loader处理完成后webpack不会自动跳出，而是会继续拿着这个js文件去 尝试匹配剩下的10个loader，相当于没有break。 ）</p>
<p>当有两个配置处理同一文件，就提到oneOf外面来。,例如js文件需要被babel-loader和eslint-loader两个loader处理，因此都需要匹配一遍并执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">oneOf</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;static/media/[hash:8][ext][query]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">          <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 排除node_modules代码不编译</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="3-Include-x2F-Exclude"><a href="#3-Include-x2F-Exclude" class="headerlink" title="3.Include&#x2F;Exclude"></a>3.Include&#x2F;Exclude</h3><p>开发时我们需要使用第三方的库或插件，所有文件都下载到node_modules 中了。而这些文件是不需要编译可以直接使用的。</p>
<p>所以我们在对 js 文件处理时，要排除 node_modules 下面的文件。</p>
<p>Include&#x2F;Exclude 同时只能使用一种，如果同时使用会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: [</span><br><span class="line"> &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">    <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">    <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">    <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="4-缓存-cache"><a href="#4-缓存-cache" class="headerlink" title="4.缓存 cache"></a>4.缓存 cache</h3><p>每次打包时 js 文件都要经过 Eslint 检查 和 Babel 编译，速度比较慢。</p>
<p>之所以需要缓存的原因在于，以babel为例，对一个项目进行编译，如果每次都是对整个项目进行重新编译比较浪费资源，因为我们可能只是对项目中进行了细微的改动，这就是为什么需要缓存的原因。</p>
<p>缓存分为babel缓存和文件资源缓存缓存。</p>
<h4 id="babel缓存"><a href="#babel缓存" class="headerlink" title="babel缓存"></a>babel缓存</h4><p>让第二次打包构建速度更快</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 进行js兼容性的处理</span></span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">    <span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">    <span class="attr">presets</span>: [</span><br><span class="line">      <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="eslint-缓存"><a href="#eslint-缓存" class="headerlink" title="eslint 缓存"></a>eslint 缓存</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">    <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">    <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">    <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">    <span class="comment">// 缓存目录</span></span><br><span class="line">    <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">      __dirname,</span><br><span class="line">      <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">    ),</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="文件资源缓存"><a href="#文件资源缓存" class="headerlink" title="文件资源缓存"></a>文件资源缓存</h4><p>如果我们在部署新版本时不更改资源的文件名，浏览器可能会认为它没有被更新，就会使用它的缓存版本。由于缓存的存在，当你需要获取新的代码时，就会显得很棘手。</p>
<p>我们可以通过修改 webpack 中 <code>output.filename</code> ，来定义输出文件的名称。</p>
<p>我们先思考两个问题：</p>
<ul>
<li><p>如果每次打包后所有的文件都重新命名，浏览器会重新下载所有的文件，相当于舍弃了缓存技术，这不是我们想要的。</p>
</li>
<li><p>如果你有一个体积巨大的文件，并且只改了一行代码，用户仍然需要重新下载整个文件。</p>
</li>
</ul>
<p>解决思路：</p>
<ul>
<li><p>我们需要让内容发生变化的文件重新命名，没有发生变化的文件不需要重新命名，读取缓存。</p>
</li>
<li><p>文件拆分，把它分为了两个文件，那么用户只需要下载那个被修改的文件即可，浏览器可以从缓存中加载另一个文件。</p>
</li>
</ul>
<p><strong>将  设置为  来定义输出文件的名称。</strong></p>
<p>三种不同的hash</p>
<ul>
<li><p><strong>hash:</strong> 每次构建的时候都会生成一个唯一的hash值，因此每次打包会导致所有的缓存失效。</p>
</li>
<li><p><strong>chunkhash</strong>：根据chunk生成hash值。如果打包来源同一个chunk,那么hash值一样。存在问题：js和css的hash值还是一样，因为css是在js中被引入的，所以同属于一个chunk</p>
</li>
<li><p><strong>contenthash：</strong>根据<strong>文件的内容</strong>生成hash值，不同文件hash值一定不一样。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理js文件</span></span><br><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;js/built.[contenthash:10].js&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;build&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//处理css文件</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-多线程-thread-loader"><a href="#5-多线程-thread-loader" class="headerlink" title="5. 多线程 thread-loader"></a>5. 多线程 thread-loader</h3><p>我们想要继续提升打包速度，其实就是要提升 js 的打包速度，因为其他文件都比较少。而对 js 文件处理主要就是 eslint 、babel、Terser （处理 js 的压缩和混淆）三个工具，所以我们要提升它们的运行速度。我们可以开启多进程同时处理 js 文件。</p>
<p>注意：开启多进程打包，进程启动大概600ms,另外进程间通信也存在开销，并不是越多越好。</p>
<p><code>npm i thread-loader -D</code> 打包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../dist&quot;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;static/js/main.js&quot;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">            <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">      <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">      <span class="attr">exclude</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 缓存目录</span></span><br><span class="line">      <span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">        __dirname,</span><br><span class="line">        <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">      ),</span><br><span class="line">      threads, <span class="comment">// 开启多进程</span></span><br><span class="line">    &#125;),</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//css  构建使用多线程 </span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">      <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">parallel</span>: threads <span class="comment">// 开启多进程</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="3-减少代码体积"><a href="#3-减少代码体积" class="headerlink" title="3.减少代码体积"></a>3.减少代码体积</h2><h3 id="1-tree-sharking：去除无用的代码"><a href="#1-tree-sharking：去除无用的代码" class="headerlink" title="1. tree sharking：去除无用的代码"></a>1. tree sharking：去除无用的代码</h3><ul>
<li><p><strong>作用</strong></p>
<p>开发时我们定义了一些工具函数库，或者引用第三方工具函数库或组件库。如果没有特殊处理的话我们打包时会引入整个库，但是实际上可能我们可能只用上极小部分的功能。如果将整个库都打包进来，体积就太大了。</p>
</li>
<li><p><strong>原理</strong></p>
<p>依赖ES Module的其中一个特性：Static module structure（静态模块结构），不能使用commonjs（<strong>es6 module 是静态模块结构，它的依赖关系的建立发生在代码编译阶段；commonjs 是动态模块结构，它的依赖关系的建立发生在代码运行阶段</strong>，</p>
<p>CommonJS模块就是一个脚本文件，require命令第一次加载该脚本时就会执行整个脚本，然后在内存中生成该模块的一个说明对象。)。</p>
</li>
<li><p><strong>tree-sharking发生在什么时期</strong></p>
<p>发生在webpack将chunk打包成bundle的** production**阶段.</p>
</li>
<li><p><strong>使用前提：</strong></p>
<ol>
<li><p>必须使用ES6（import&#x2F;export）语法。</p>
</li>
<li><p>开启** production**环境自动会开启，开发环境不会启动。 &amp;#x20;</p>
</li>
<li><p>package.json中配置<code>&quot;sideEffects&quot;:false</code> （副作用）使所有代码没有副作用，都可以进行tree shaking，因此可能会导致css文件或者其他文件删除。</p>
<p>此时可以改成<code>&quot;sideEffects&quot;:[&quot;*.css&quot;]</code>,防止过滤掉css,文件，</p>
<p>一般不会配置<code>sideEffects</code></p>
</li>
</ol>
</li>
</ul>
<h3 id="2-本地图片压缩"><a href="#2-本地图片压缩" class="headerlink" title="2.本地图片压缩"></a>2.本地图片压缩</h3><p>开发如果项目中引用了较多图片，那么图片体积会比较大，将来请求速度比较慢。</p>
<p>我们可以对图片进行压缩，减少图片体积。</p>
<p><strong>注意：如果项目中图片都是在线链接，那么就不需要了。本地项目静态图片才需要进行压缩。</strong></p>
<p><code>image-minimizer-webpack-plugin</code>: 用来压缩图片的插件</p>
<h2 id="4-优化运行性能"><a href="#4-优化运行性能" class="headerlink" title="4.优化运行性能"></a>4.优化运行性能</h2><h3 id="1-code-split-代码分割"><a href="#1-code-split-代码分割" class="headerlink" title="1.code split 代码分割"></a>1.code split 代码分割</h3><ul>
<li><p>** 作用**​</p>
<p>分割文件：将打包生成的文件进行分割，生成多个 js 文件。</p>
<p>按需加载：需要哪个文件就加载哪个文件。</p>
<p>代码复用</p>
</li>
<li><p><strong>多入口分割</strong></p>
<p>代码有多少个入口就有多少个分割</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: &#123;</span><br><span class="line">  <span class="attr">app</span>:<span class="string">&quot;./src/app.js&quot;</span>,</span><br><span class="line">  main :<span class="string">&quot;./src/main.js&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">  <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>splitChunks</p>
<p>根据设定的规则进行分包处理。</p>
<p>**提取重复代码 **如果多入口文件中都引用了同一份代码，默认情况下代码被打包到两个文件中，导致代码重复，体积更大。</p>
<p>我们需要提取多入口的重复代码，打包生成一个 js 文件，其他文件引用它就好。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="comment">// 代码分割配置</span></span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">    <span class="comment">// 以下是所有组默认值</span></span><br><span class="line">    <span class="comment">// minSize: 20000, // 分割代码最小的大小</span></span><br><span class="line">    <span class="comment">// minRemainingSize: 0, // 类似于minSize，最后确保提取的文件大小不能为0</span></span><br><span class="line">    <span class="comment">// minChunks: 1, // 至少被引用的次数，满足条件才会代码分割</span></span><br><span class="line">    <span class="comment">// maxAsyncRequests: 30, // 按需加载时并行加载的文件的最大数量</span></span><br><span class="line">    <span class="comment">// maxInitialRequests: 30, // 入口js文件最大并行请求数量</span></span><br><span class="line">    <span class="comment">// enforceSizeThreshold: 50000, // 超过50kb一定会单独打包（此时会忽略minRemainingSize、maxAsyncRequests、maxInitialRequests）</span></span><br><span class="line">    <span class="comment">// cacheGroups: &#123; // 组，哪些模块要打包到一个组</span></span><br><span class="line">    <span class="comment">//   defaultVendors: &#123; // 组名</span></span><br><span class="line">    <span class="comment">//     test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span></span><br><span class="line">    <span class="comment">//     priority: -10, // 权重（越大越高）</span></span><br><span class="line">    <span class="comment">//     reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span></span><br><span class="line">    <span class="comment">//   &#125;,</span></span><br><span class="line">    <span class="comment">//   default: &#123; // 其他没有写的配置会使用上面的默认值</span></span><br><span class="line">    <span class="comment">//     minChunks: 2, // 这里的minChunks权重更大</span></span><br><span class="line">    <span class="comment">//     priority: -20,</span></span><br><span class="line">    <span class="comment">//     reuseExistingChunk: true,</span></span><br><span class="line">    <span class="comment">//   &#125;,</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// 修改配置</span></span><br><span class="line">    <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">      <span class="comment">// 组，哪些模块要打包到一个组</span></span><br><span class="line">      <span class="comment">// defaultVendors: &#123; // 组名</span></span><br><span class="line">      <span class="comment">//   test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span></span><br><span class="line">      <span class="comment">//   priority: -10, // 权重（越大越高）</span></span><br><span class="line">      <span class="comment">//   reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="attr">default</span>: &#123;</span><br><span class="line">        <span class="comment">// 其他没有写的配置会使用上面的默认值</span></span><br><span class="line">        <span class="attr">minSize</span>: <span class="number">0</span>, <span class="comment">// 我们定义的文件体积太小了，所以要改打包的最小文件体积</span></span><br><span class="line">        <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">priority</span>: -<span class="number">20</span>,</span><br><span class="line">        <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>按需加载动态导入</strong></p>
<p>页面加载时候不加载部分代码，而是当某个事件发生时候按需导入。</p>
<p>需要改变引入方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>).<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 动态导入 --&gt; 实现按需加载</span></span><br><span class="line">  <span class="comment">// 即使只被引用了一次，也会代码分割</span></span><br><span class="line">  <span class="title function_">import</span>(<span class="string">&quot;./math.js&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; sum &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">  &#125;).<span class="title function_">cathc</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;失败&quot;</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>此时，eslint会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint-plugin-<span class="keyword">import</span> -D</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"> <span class="attr">plugins</span>: [<span class="string">&quot;import&quot;</span>], <span class="comment">// 解决动态导入import语法报错问题 --&gt; 实际使用eslint-plugin-import的规则解决的</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>单入口</p>
<p>单入口+代码分割+动态导入<br>开发时spa应用，只有一个入口。只有一个入口文件直接使用默认splitChunks即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="comment">// 代码分割配置</span></span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>, </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置动态导入文件命名。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn&quot;</span>).<span class="property">onClick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// eslint会对动态导入语法报错，需要修改eslint配置文件</span></span><br><span class="line">  <span class="comment">// webpackChunkName: &quot;math&quot;：这是webpack动态导入模块命名的方式</span></span><br><span class="line">  <span class="comment">// &quot;math&quot;将来就会作为[name]的值显示。</span></span><br><span class="line">  <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;math&quot; */</span> <span class="string">&quot;./js/math.js&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; count &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>webpack</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname,<span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">  <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">chunkFilename</span>: <span class="string">&quot;static/js/[name].chunk.js&quot;</span>, <span class="comment">// 动态导入输出资源命名方式</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-preload-prefetch"><a href="#2-preload-prefetch" class="headerlink" title="2.preload prefetch"></a>2.preload prefetch</h3><p>我们前面已经做了代码分割，同时会使用 import 动态导入语法来进行代码按需加载（我们也叫懒加载，比如路由懒加载就是这样实现的）。</p>
<p>但是加载速度还不够好，比如：是用户点击按钮时才加载这个资源的，如果资源体积很大，那么用户会感觉到明显卡顿效果。</p>
<p>我们想在浏览器空闲时间，加载后续需要使用的资源。我们就需要用上 <code>Preload</code> 或 <code>Prefetch</code> 技术</p>
<ul>
<li><p><code>Preload</code>：告诉浏览器立即加载资源。</p>
</li>
<li><p><code>Prefetch</code>：告诉浏览器在空闲时才开始加载资源。</p>
</li>
</ul>
<p>共同点</p>
<ul>
<li><p>都只会加载资源，并不执行。</p>
</li>
<li><p>都有缓存。</p>
</li>
</ul>
<p>区别</p>
<ul>
<li><p><code>Preload</code>加载优先级高，<code>Prefetch</code>加载优先级低。</p>
</li>
<li><p><code>Preload</code>只能加载当前页面需要使用的资源，<code>Prefetch</code>可以加载当前页面资源，也可以加载下一个页面需要使用的资源。</p>
</li>
<li><p>preload 兼容性比prefetch好。</p>
</li>
</ul>
<ol>
<li><p>安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @vue/preload-webpack-plugin -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">PreloadWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;@vue/preload-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">PreloadWebpackPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">rel</span>: <span class="string">&quot;preload&quot;</span>, <span class="comment">// preload兼容性更好</span></span><br><span class="line">  <span class="attr">as</span>: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">  <span class="comment">// rel: &#x27;prefetch&#x27; // prefetch兼容性更差</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-network-cache（浏览器缓存）"><a href="#3-network-cache（浏览器缓存）" class="headerlink" title="3.network cache（浏览器缓存）"></a>3.network cache（浏览器缓存）</h3><p>如果有A,B两个模块，A引用了B模块。当B模块发生改变，必然会生产新的打包文件，由于A内部引用了B，A也会发生改变。因此A也会重新打包，（当修改 math.js 文件再重新打包的时候，因为 contenthash 原因，math.js 文件 hash 值发生了变化（这是正常的）。但是 main.js 文件的 hash 值也发生了变化，这会导致 main.js 的缓存失效。）</p>
<ul>
<li><strong>解决：将 hash 值单独保管在一个 runtime 文件中。</strong></li>
</ul>
<p>我们最终输出三个文件：main、math、runtime。当 math 文件发送变化，变化的是 math 和 runtime 文件，main 不变。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">runtimeChunk</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="function">(<span class="params">entrypoint</span>) =&gt;</span> <span class="string">`runtime~<span class="subst">$&#123;entrypoint.name&#125;</span>`</span>, <span class="comment">// runtime文件命名规则</span></span><br><span class="line">    &#125;,</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-core-js"><a href="#4-core-js" class="headerlink" title="4.core-js"></a>4.core-js</h3><p>js 构成部分可以简单理解成’语法’ + ‘api’，babel使用AST对语法进行转换，而对于一些api需要使用cores-js进行兼容性处理。</p>
<p>&amp;#x20;我们已经使用过babel 对 js 代码进行了兼容性处理，它能将 ES6 的一些<strong>语法</strong>进行编译转换，比如箭头函数、点点点运算符等。</p>
<p>但是如果是 async 函数、promise 对象、数组的一些方法（includes）等，它没办法处理。</p>
<p><code>core-js</code> 是专门用来做 ES6 以及以上 API 的 <code>polyfill</code>。</p>
<p><code>polyfill</code>翻译过来叫做垫片&#x2F;补丁。就是用社区上提供的一段代码，让我们在不兼容某些新特性的浏览器上，使用该新特性。</p>
<p>使用：</p>
<p>创建babel.config.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 智能预设：能够编译ES6语法</span></span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      <span class="comment">// 按需加载core-js的polyfill</span></span><br><span class="line">      &#123; <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>, <span class="attr">corejs</span>: &#123; <span class="attr">version</span>: <span class="string">&quot;3&quot;</span>, <span class="attr">proposals</span>: <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="5-PWA"><a href="#5-PWA" class="headerlink" title="5.PWA"></a>5.PWA</h3><p>渐进式网络应用程序(progressive web application - PWA)，是一种可以提供类似于native app(原生应用程序) 体验的 web app(网络应用程序)。可以离线访问。（离线可访问技术）</p>
<p>原理：利用浏览器service-worker另启一个线程，这个线程负责去监听所有https请求（注意是https）,当发现某些资源是需要缓存下来的他会把资源拉取到浏览器本地，访问的时候拦截请求，不走网络请求，直接读取本地资源。</p>
<ol>
<li><p>安装</p>
<p><code>npm i workbox-webpack-plugin -D</code></p>
</li>
<li><p>配置文件webpack.config.js</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">WorkboxPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;workbox-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">WorkboxPlugin</span>.<span class="title class_">GenerateSW</span>(&#123;</span><br><span class="line">       <span class="comment">// 这些选项帮助快速启用 ServiceWorkers</span></span><br><span class="line">       <span class="comment">// 不允许遗留任何“旧的” ServiceWorkers</span></span><br><span class="line">       <span class="attr">clientsClaim</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="attr">skipWaiting</span>: <span class="literal">true</span>,</span><br><span class="line">     &#125;),</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>

<p>3.在main.js中注册生成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.<span class="property">serviceWorker</span></span><br><span class="line">      .<span class="title function_">register</span>(<span class="string">&quot;/service-worker.js&quot;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">registration</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SW registered: &quot;</span>, registration);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">registrationError</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;SW registration failed: &quot;</span>, registrationError);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-externals"><a href="#6-externals" class="headerlink" title="6.externals"></a>6.externals</h3><p>「<strong>从输出的 bundle 中排除依赖</strong>」的方法。此功能通常对 <strong>library 开发人员</strong>来说是最有用的，然而也会有各种各样的应用程序用到它。防止引入CDN文件被加载。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">externals</span>:&#123;</span><br><span class="line">  <span class="attr">jquery</span>:<span class="string">&#x27;jQuery&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="五、webpack-react"><a href="#五、webpack-react" class="headerlink" title="五、webpack react"></a>五、webpack react</h1><p>react-scripts 是 create-react-app 的一个核心包，一些脚本和工具的默认配置都集成在里面，而 <code>npm run eject </code>命令执行后会将封装在 create-react-app 中的配置全部反编译到当前项目，这样用户就能完全取得 webpack 文件的控制权。所以，eject 命令存在的意义就是更改 webpack 配置。注意！开发环境不要使用，指令不可逆。 会多出一个config目录,就是webpack配置文件。</p>
<p>package.json</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;react-scripts start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;react-scripts build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;react-scripts test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eject&quot;</span>: <span class="string">&quot;react-scripts eject&quot;</span>   <span class="comment">//暴露出webpack配置</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.wolai.com/sA43yCbFFNd8PjAhjsyBns" title="react  webpack">react  webpack</a></p>
<p><a target="_blank" rel="noopener" href="https://www.wolai.com/4haebNhRNR8meAZnNzxUbX" title="原理">原理</a></p>
<p><a target="_blank" rel="noopener" href="https://www.wolai.com/qa2xWhhoNnfK4QoZs2qicA" title="问题">问题</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://xiaozhwien.cluod">肖智文</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://xiaozhwien.cluod/webpack/webpack/">https://xiaozhwien.cluod/webpack/webpack/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://xiaozhwien.cluod" target="_blank">Wen</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/webpack/">webpack</a></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://xiaozhiwen-hexo.oss-cn-hangzhou.aliyuncs.com/hexo-img/f178a405aa4907345cd364a966f5ba7.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://xiaozhiwen-hexo.oss-cn-hangzhou.aliyuncs.com/hexo-img/f178a405aa4907345cd364a966f5ba7.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://xiaozhiwen-hexo.oss-cn-hangzhou.aliyuncs.com/hexo-img/f178a405aa4907345cd364a966f5ba7.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://xiaozhiwen-hexo.oss-cn-hangzhou.aliyuncs.com/hexo-img/7ffe3896b9e0a22f4e53902507cd6c3.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">设计模式</div></div></a></div><div class="next-post pull-right"><a href="/js/js/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">js基础</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/webpack/webpack%E7%9A%84loader,plugin%E5%8E%9F%E7%90%86/" title="webpack的loader,plugin原理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-08</div><div class="title">webpack的loader,plugin原理</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#webpack"><span class="toc-number">1.</span> <span class="toc-text">webpack</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%EF%BC%9F%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">一、为什么需要打包工具？？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%A6%82%E5%BF%B5"><span class="toc-number">3.</span> <span class="toc-text">二、概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npx%E5%92%8Cnpm"><span class="toc-number">3.2.</span> <span class="toc-text">npx和npm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#module%E3%80%81chunk%E3%80%81bundle"><span class="toc-number">3.3.</span> <span class="toc-text">module、chunk、bundle</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.</span> <span class="toc-text">三、最简单的配置文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">5.</span> <span class="toc-text">四、开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.1.</span> <span class="toc-text">开发环境介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E5%AE%89%E8%A3%85"><span class="toc-number">5.2.</span> <span class="toc-text">0.安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%A4%84%E7%90%86css%E8%B5%84%E6%BA%90"><span class="toc-number">5.3.</span> <span class="toc-text">1.处理css资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-css"><span class="toc-number">5.3.1.</span> <span class="toc-text">1.css</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-less"><span class="toc-number">5.3.2.</span> <span class="toc-text">2.less</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-sass"><span class="toc-number">5.3.3.</span> <span class="toc-text">3.sass</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%A4%84%E7%90%86js%E8%B5%84%E6%BA%90"><span class="toc-number">5.4.</span> <span class="toc-text">2.处理js资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-eslint"><span class="toc-number">5.4.1.</span> <span class="toc-text">1.eslint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-babel%E4%BB%A3%E7%A0%81%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-number">5.4.2.</span> <span class="toc-text">2.babel代码兼容性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%B8%85%E7%A9%BA%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.</span> <span class="toc-text">3.清空打包文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%89%93%E5%8C%85%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90"><span class="toc-number">5.6.</span> <span class="toc-text">4.打包图片资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AD%97%E4%BD%93%E5%8F%8A%E5%9B%BE%E6%A0%87%E7%AD%89%E8%B5%84%E6%BA%90%E7%9A%84%E6%89%93%E5%8C%85"><span class="toc-number">5.7.</span> <span class="toc-text">5.字体及图标等资源的打包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E4%BF%AE%E6%94%B9%E8%BE%93%E5%87%BA%E8%B5%84%E6%BA%90%E8%B7%AF%E5%BE%84%E5%90%8D%E7%A7%B0"><span class="toc-number">5.8.</span> <span class="toc-text">6.修改输出资源路径名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-html%E8%B5%84%E6%BA%90%E6%89%93%E5%8C%85-%EF%BC%88htmlWebpackPlugin%EF%BC%89"><span class="toc-number">5.9.</span> <span class="toc-text">7.html资源打包 （htmlWebpackPlugin）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-dev-server-%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">5.10.</span> <span class="toc-text">8.dev-server 热部署</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83"><span class="toc-number">6.</span> <span class="toc-text">五、生产环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8F%90%E5%8F%96CSS%E6%88%90%E5%8D%95%E7%8B%AC%E6%96%87%E4%BB%B6"><span class="toc-number">6.1.</span> <span class="toc-text">1.提取CSS成单独文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-css%E5%85%BC%E5%AE%B9%E6%80%A7%E5%A4%84%E7%90%86postcss"><span class="toc-number">6.2.</span> <span class="toc-text">2.css兼容性处理postcss</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8E%8B%E7%BC%A9css%E4%BB%A3%E7%A0%81"><span class="toc-number">6.3.</span> <span class="toc-text">3.压缩css代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B8%85%E9%99%A4%E6%97%A0%E7%94%A8%E7%9A%84-CSS"><span class="toc-number">6.4.</span> <span class="toc-text">4.清除无用的 CSS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%BC%80%E5%8F%91%E5%92%8C%E7%94%9F%E4%BA%A7%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.5.</span> <span class="toc-text">合并开发和生产模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81webpack%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text">六、webpack性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95%E4%BC%98%E5%8C%96"><span class="toc-number">7.1.</span> <span class="toc-text">1.代码调试优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#source-map-amp-x20"><span class="toc-number">7.1.1.</span> <span class="toc-text">source map&amp;#x20;</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Source-Map-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">7.1.1.1.</span> <span class="toc-text">Source Map 的工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%90%8Csource-map%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">7.1.1.2.</span> <span class="toc-text">不同source map的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E8%AF%B4%E6%98%8E"><span class="toc-number">7.1.1.3.</span> <span class="toc-text">代码质量说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E8%AE%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">7.1.1.4.</span> <span class="toc-text">建议配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8F%90%E5%8D%87%E6%89%93%E5%8C%85%E9%80%9F%E5%BA%A6"><span class="toc-number">7.2.</span> <span class="toc-text">2. 提升打包速度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-HMR"><span class="toc-number">7.2.1.</span> <span class="toc-text">1.HMR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-oneof"><span class="toc-number">7.2.2.</span> <span class="toc-text">2.oneof</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Include-x2F-Exclude"><span class="toc-number">7.2.3.</span> <span class="toc-text">3.Include&#x2F;Exclude</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%BC%93%E5%AD%98-cache"><span class="toc-number">7.2.4.</span> <span class="toc-text">4.缓存 cache</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#babel%E7%BC%93%E5%AD%98"><span class="toc-number">7.2.4.1.</span> <span class="toc-text">babel缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#eslint-%E7%BC%93%E5%AD%98"><span class="toc-number">7.2.4.2.</span> <span class="toc-text">eslint 缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98"><span class="toc-number">7.2.4.3.</span> <span class="toc-text">文件资源缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%A4%9A%E7%BA%BF%E7%A8%8B-thread-loader"><span class="toc-number">7.2.5.</span> <span class="toc-text">5. 多线程 thread-loader</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%87%8F%E5%B0%91%E4%BB%A3%E7%A0%81%E4%BD%93%E7%A7%AF"><span class="toc-number">7.3.</span> <span class="toc-text">3.减少代码体积</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-tree-sharking%EF%BC%9A%E5%8E%BB%E9%99%A4%E6%97%A0%E7%94%A8%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-number">7.3.1.</span> <span class="toc-text">1. tree sharking：去除无用的代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9"><span class="toc-number">7.3.2.</span> <span class="toc-text">2.本地图片压缩</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BC%98%E5%8C%96%E8%BF%90%E8%A1%8C%E6%80%A7%E8%83%BD"><span class="toc-number">7.4.</span> <span class="toc-text">4.优化运行性能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-code-split-%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2"><span class="toc-number">7.4.1.</span> <span class="toc-text">1.code split 代码分割</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-preload-prefetch"><span class="toc-number">7.4.2.</span> <span class="toc-text">2.preload prefetch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-network-cache%EF%BC%88%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%EF%BC%89"><span class="toc-number">7.4.3.</span> <span class="toc-text">3.network cache（浏览器缓存）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-core-js"><span class="toc-number">7.4.4.</span> <span class="toc-text">4.core-js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-PWA"><span class="toc-number">7.4.5.</span> <span class="toc-text">5.PWA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-externals"><span class="toc-number">7.4.6.</span> <span class="toc-text">6.externals</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81webpack-react"><span class="toc-number">8.</span> <span class="toc-text">五、webpack react</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://fastly.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 By 肖智文</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="icp链接"><img class="icp-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gw.alicdn.com/tfs/TB1jwakrbH1gK0jSZFwXXc7aXXa-20-20.png"><span>备案号：赣ICP备2022003304号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-phi-blue.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-phi-blue.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div></div></body></html>